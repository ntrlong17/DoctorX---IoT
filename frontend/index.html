<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>DoctorX - H·ªá th·ªëng gi√°m s√°t s·ª©c kh·ªèe</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;

      /* cƒÉn gi·ªØa kh·ªëi login */
      display: flex;
      align-items: center;
      justify-content: center;

      background-color: #020617;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    .portal-wrapper {
      width: 900px;
      max-width: 95vw;
      background: rgba(255, 255, 255, 0.18);
      border-radius: 18px;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: flex;
      position: relative;
      overflow: visible;
    }

    .portal-left {
      width: 40%;
      background: linear-gradient(135deg, #42a5f5, #1e88e5);
      color: #fff;
      padding: 40px 40px 40px 60px;
      display: none; /* t·∫°m ·∫©n n·∫øu b·∫°n ch∆∞a mu·ªën d√πng b√™n tr√°i */
      flex-direction: column;
      justify-content: center;
      position: relative;
    }

    .portal-left-content {
      max-width: 360px;
    }

    .portal-logo {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: 1px;
      margin-bottom: 24px;
      line-height: 1.4;
    }

    .portal-title {
      font-size: 22px;
      font-weight: 700;
      line-height: 1.4;
      text-transform: uppercase;
    }

    .portal-sub {
      margin-top: 24px;
      font-size: 14px;
      opacity: 0.95;
    }

    .portal-left-circle {
      position: absolute;
      right: -40px;
      top: 50%;
      transform: translateY(-50%);
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .portal-left-circle-inner {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .logo-doctorx {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
    }

    .portal-right {
      width: 100%;
      padding: 32px 40px 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
    }

    #auth-card {
      position: relative;
    }

    .hello-title {
      font-size: 32px;
      font-weight: 800;
      text-align: center;
      color: #1565c0;
      margin-top: 40px;
      margin-bottom: 8px;
    }

    .hello-sub {
      margin-top: 4px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #0b1f3b;
      text-align: center;
    }

    .form-group {
      margin-bottom: 14px;
    }

    #auth-card label {
      font-size: 14px;
      font-weight: 600;
      color: #0b1f3b;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: #333;
    }

    .input-wrapper {
      display: flex;
      align-items: center;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      padding: 4px 14px;
      background: #f9fafb;
    }

    .input-wrapper span.icon {
      margin-right: 8px;
      color: #888;
      font-size: 14px;
    }

    .input-wrapper input {
      border: none;
      outline: none;
      background: transparent;
      flex: 1;
      font-size: 14px;
      padding: 6px 0;
    }

    button.primary-btn {
      border: none;
      outline: none;
      border-radius: 999px;
      background: #1565c0;
      color: #fff;
      padding: 10px 32px;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: background 0.18s ease, transform 0.08s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
    }

    button.primary-btn:hover {
      background: #c62828;
      transform: translateY(-1px);
    }

    button.primary-btn:active {
      transform: translateY(0);
    }

    .toggle-link {
      margin-top: 10px;
      font-size: 13px;
      color: #1565c0;
      cursor: pointer;
      text-align: center;
    }

    .toggle-link:hover {
      text-decoration: underline;
    }

    .auth-extra-links {
      margin-top: 8px;
      font-size: 13px;
      text-align: center;
    }

    .auth-extra-links a {
      color: #1565c0;
      text-decoration: none;
      margin: 0 4px;
    }

    .auth-extra-links a:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none;
    }

    .small-text {
      font-size: 12px;
      color: #777;
      margin-top: 10px;
      text-align: center;
    }

    /* LOG CLIENT */
    .log-card {
      width: 1100px;
      max-width: 95vw;
      margin-top: 18px;
      padding: 10px 14px;
      background: rgba(0,0,0,0.9);
      color: #0f0;
      border-radius: 10px;
      font-size: 12px;
      max-height: 160px;
      overflow: auto;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
      display: none; /* b·∫≠t l√™n n·∫øu mu·ªën xem log */
    }

    .log-card-title {
      color: #fff;
      font-weight: 600;
      margin-bottom: 6px;
    }

    /* Logo tr√≤n n·ªïi ph√≠a tr√™n khung */
    .auth-logo-float {
      position: absolute;
      top: -80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }

    .auth-logo-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #ffffffee;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
    }

    .auth-logo-circle img {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
    }

    .realtime-clock {
      position: fixed;      /* d√≠nh theo m√†n h√¨nh */
      right: 20px;          /* c√°ch m√©p ph·∫£i 20px */
      bottom: 20px;         /* c√°ch m√©p d∆∞·ªõi 20px */
      z-index: 9999;        /* n·∫±m tr√™n m·ªçi th·ª© */

      padding: 12px 26px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
      font-size: 18px;
      font-weight: 500;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
    }

    @media (max-width: 900px) {
      .portal-wrapper {
        flex-direction: column;
      }
      .portal-left, .portal-right {
        width: 100%;
      }
      .portal-left {
        border-radius: 18px 18px 0 0;
      }
      .portal-left-circle {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="portal-wrapper">
    <!-- B√äN TR√ÅI: BRAND (c√≥ th·ªÉ d√πng sau) -->
    <div class="portal-left">
      <div class="portal-logo">
        Welcome to the arena of discipline
      </div>
      <div class="portal-left-circle">
        <div class="portal-left-circle-inner">
          <img src="/static/doctorx_logo.png" alt="DoctorX logo" class="logo-doctorx" />
        </div>
      </div>
    </div>

    <!-- B√äN PH·∫¢I: AUTH -->
    <div class="portal-right">
      <div id="auth-card">
        <div class="auth-logo-float">
          <div class="auth-logo-circle">
            <img src="/static/doctorx_logo.png" alt="DoctorX logo" />
          </div>
        </div>

        <h1 class="hello-title">XIN CH√ÄO!</h1>
        <p class="hello-sub">
          ƒêƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng h·ªá th·ªëng. N·∫øu ch∆∞a c√≥ t√†i kho·∫£n, h√£y ƒëƒÉng k√Ω tr∆∞·ªõc nh√©.
        </p>

        <!-- LOGIN FORM -->
        <div id="login-section">
          <div class="form-group">
            <label>Email</label>
            <div class="input-wrapper">
              <span class="icon">üë§</span>
              <input type="email" id="login-email" placeholder="Nh·∫≠p email c·ªßa b·∫°n" />
            </div>
          </div>
          <div class="form-group">
            <label>M·∫≠t kh·∫©u</label>
            <div class="input-wrapper">
              <span class="icon">üîí</span>
              <input
                type="password"
                id="login-pass"
                placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                maxlength="72"
              />
            </div>
          </div>

          <button class="primary-btn" onclick="login()">ƒêƒÇNG NH·∫¨P</button>
          <div class="auth-extra-links">
            <a href="/forgot-password">Qu√™n m·∫≠t kh·∫©u?</a>
            <span>‚Ä¢</span>
            <a href="#" onclick="forgotEmail(event)">Qu√™n t√†i kho·∫£n?</a>
          </div>

          <div class="toggle-link" onclick="showRegister()">
            Ch∆∞a c√≥ t√†i kho·∫£n? <b>ƒêƒÉng k√Ω</b>
          </div>
        </div>

        <!-- REGISTER FORM -->
        <div id="register-section" class="hidden">
          <div class="form-group">
            <label>Email</label>
            <div class="input-wrapper">
              <span class="icon">üìß</span>
              <input type="email" id="reg-email" placeholder="Nh·∫≠p email ƒë·ªÉ ƒëƒÉng k√Ω" />
            </div>
          </div>
          <div class="form-group">
            <label>M·∫≠t kh·∫©u</label>
            <div class="input-wrapper">
              <span class="icon">üîë</span>
              <input
                type="password"
                id="reg-pass"
                placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±"
                maxlength="72"
              />
            </div>
          </div>

          <button class="primary-btn" onclick="register()">ƒêƒÇNG K√ù</button>
          <div class="toggle-link" onclick="showLogin()">
            ƒê√£ c√≥ t√†i kho·∫£n? <b>ƒêƒÉng nh·∫≠p</b>
          </div>
        </div>

        <p class="small-text" id="auth-status"></p>
      </div>
    </div>
  </div>

  <!-- Log client (·∫©n) -->
  <div class="log-card">
    <div class="log-card-title">Client log</div>
    <pre id="log"></pre>
  </div>

  <!-- ƒê·ªìng h·ªì th·ªùi gian th·ª±c (g√≥c ph·∫£i d∆∞·ªõi) -->
  <div class="realtime-clock" id="realtime-clock"></div>

  <script>
    const API_BASE = "";
    let accessToken = null;
    let currentEmail = null;
    let devicesCache = [];

    function log(msg) {
      const box = document.getElementById("log");
      if (!box) return;
      box.textContent += msg + "\n";
      box.scrollTop = box.scrollHeight;
    }

    function showRegister() {
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("register-section").classList.remove("hidden");
    }

    function showLogin() {
      document.getElementById("register-section").classList.add("hidden");
      document.getElementById("login-section").classList.remove("hidden");
    }

    async function register() {
      const email = document.getElementById("reg-email").value.trim();
      const pass = document.getElementById("reg-pass").value.trim();
      if (!email || !pass) {
        alert("Nh·∫≠p email v√† m·∫≠t kh·∫©u ƒë·ªÉ ƒëƒÉng k√Ω");
        return;
      }
      try {
        const res = await fetch(API_BASE + "/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password: pass }),
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) {
          alert("ƒêƒÉng k√Ω th·∫•t b·∫°i: " + (data.detail || res.status));
          log("Register failed: " + JSON.stringify(data));
        } else {
          alert("ƒêƒÉng k√Ω th√†nh c√¥ng, b√¢y gi·ªù h√£y ƒëƒÉng nh·∫≠p.");
          log("Registered: " + JSON.stringify(data));
          showLogin();
          document.getElementById("login-email").value = email;
        }
      } catch (e) {
        alert("L·ªói m·∫°ng khi ƒëƒÉng k√Ω");
        log("Register error: " + e);
      }
    }

    async function login() {
      const email = document.getElementById("login-email").value.trim();
      const pass = document.getElementById("login-pass").value.trim();
      if (!email || !pass) {
        alert("Nh·∫≠p email v√† m·∫≠t kh·∫©u ƒë·ªÉ ƒëƒÉng nh·∫≠p");
        return;
      }
      try {
        const body = new URLSearchParams();
        body.append("username", email);
        body.append("password", pass);

        const res = await fetch(API_BASE + "/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body,
        });
        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          alert("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: " + (data.detail || res.status));
          log("Login failed: " + JSON.stringify(data));
          return;
        }

        const token = data.access_token;
        if (!token) {
          alert("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: kh√¥ng nh·∫≠n ƒë∆∞·ª£c token.");
          log("Login missing token: " + JSON.stringify(data));
          return;
        }

        localStorage.setItem("access_token", token);
        localStorage.setItem("user_email", email);

        log("Login success, redirect to /dashboard");
        window.location.href = "/dashboard";
      } catch (e) {
        alert("L·ªói m·∫°ng khi ƒëƒÉng nh·∫≠p");
        log("Login error: " + e);
      }
    }

    function forgotEmail(event) {
      event.preventDefault();
      alert(
        "N·∫øu b·∫°n qu√™n email/t√†i kho·∫£n, h√£y li√™n h·ªá qu·∫£n tr·ªã h·ªá th·ªëng ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£."
      );
    }

    // =========================
    // ƒê·ªíNG H·ªí TH·ªúI GIAN TH·ª∞C
    // =========================
    function updateClock() {
      const clockEl = document.getElementById("realtime-clock");
      if (!clockEl) return;

      const now = new Date();
      const time = now.toLocaleTimeString("vi-VN", {
        hour: "2-digit",
        minute: "2-digit",
        hour12: false,
      });

      clockEl.textContent = time;
    }

    updateClock();
    setInterval(updateClock, 1000);

    // =========================
    // ƒê·ªîI BACKGROUND THEO GI·ªú
    // =========================
    function setTimeTheme() {
      const hour = new Date().getHours();
      let bg = "/static/Morning.png"; // m·∫∑c ƒë·ªãnh s√°ng

      if (hour >= 5 && hour < 11) {
        bg = "/static/Morning.png";
      } else if (hour >= 11 && hour < 14) {
        bg = "/static/Lunch.png";
      } else if (hour >= 14 && hour < 18) {
        bg = "/static/Afternoon.png";
      } else {
        bg = "/static/Night.png";
      }

      document.body.style.backgroundImage = `url('${bg}')`;
    }

    setTimeTheme();
    setInterval(setTimeTheme, 10 * 60 * 1000);
  </script>
</body>
</html>
