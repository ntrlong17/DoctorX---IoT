<!DOCTYPE html>
<html lang="vi">
  <head>
    <!-- Thi·∫øt l·∫≠p b·∫£ng m√£ ti·∫øng Vi·ªát -->
    <meta charset="UTF-8" />
    <!-- Ti√™u ƒë·ªÅ tab tr√¨nh duy·ªát -->
    <title>DoctorX - Garden</title>

    <!-- Th∆∞ vi·ªán Chart.js (hi·ªán t·∫°i ch∆∞a d√πng, ƒë·ªÉ sau n·∫øu c·∫ßn v·∫Ω bi·ªÉu ƒë·ªì) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* Reset m·∫∑c ƒë·ªãnh */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      /* To√†n b·ªô body trang */
      body {
        font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;

        /* Gradient n·ªÅn m·∫∑c ƒë·ªãnh (tr∆∞·ªõc khi JS set h√¨nh theo gi·ªù) */
        background: radial-gradient(
          circle at top left,
          #1e293b 0,
          #020617 45%,
          #000 100%
        );

        color: #e5e7eb;
        min-height: 100vh;

        /* Thu nh·ªè giao di·ªán (n·∫øu mu·ªën to h∆°n n√¢ng l√™n 0.9) */
        zoom: 0.8;

        /* S·∫Ω b·ªã thay b·∫±ng ·∫£nh trong JS theo bu·ªïi trong ng√†y */
        background-color: #020617;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
      }

      /* Khung ch·ª©a sidebar + main b√™n ph·∫£i */
      .app-shell {
        display: flex;
        min-height: 100vh;
      }

      /* ========================= SIDEBAR ========================= */

      .sidebar {
        width: 350px;
        background: rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        padding: 22px 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        border-right: 1px solid rgba(15, 23, 42, 0.7);
        box-shadow: 4px 0 25px rgba(0, 0, 0, 0.5);
      }

      .sidebar-brand {
        display: flex;
        align-items: center;
        gap: 17px;
        padding: 30px 32px;
        border-radius: 16px;
        background: radial-gradient(circle at top left, #22c55e55, #0f172a 60%);
      }

.sidebar-brand-icon {
        /* khung logo vu√¥ng, kh√¥ng b·ªã co */
        width: 80px;
        height: 80px;
        flex: 0 0 80px;          /* kh√≥a chi·ªÅu r·ªông trong flex */
        aspect-ratio: 1 / 1;

        border-radius: 100%;      /* bo tr√≤n khung */
        background: #0f172a;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;        /* c·∫Øt ph·∫ßn ·∫£nh th·ª´a */
        padding: 0;
      }

      .sidebar-brand-icon img {
        width: 100%;
        height: 100%;
        object-fit: cover;       /* cƒÉng ƒë·∫ßy khung, kh√¥ng m√©o */
        border-radius: 100%;      /* b·∫£n th√¢n ·∫£nh c≈©ng tr√≤n */
        display: block;
      }

      .sidebar-brand-text-main {
        font-size: 25px;
        font-weight: 700;
      }

      .sidebar-brand-text-sub {
        font-size: 15px;
        color: #9ca3af;
      }

      .sidebar-nav {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-top: 4px;
        gap: 50px;
        justify-content: flex-start;
      }

      .nav-label-heading {
        font-size: 30px;
        letter-spacing: 10px;
        text-transform: uppercase;
        color: #6b7280;
        padding: 0 4px 4px;
      }

      .nav-item {
        width: 100%;
        border: none;
        border-radius: 14px;
        padding: 12px 16px;
        min-height: 54px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 14px;
        font-weight: 500;
        color: #cbd5f5;
        background: transparent;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.1s ease;
      }

      .nav-item:hover {
        background: rgba(148, 163, 184, 0.12);
        transform: translateY(-1px);
      }

      .nav-item.active {
        background: linear-gradient(90deg, #22d3ee, #22c55e);
        color: #0f172a;
        box-shadow: 0 10px 24px rgba(34, 211, 238, 0.45);
      }

      .nav-icon {
        width: 34px;
        height: 34px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        flex-shrink: 0;
      }

      .nav-item.active .nav-icon {
        background: rgba(15, 23, 42, 0.1);
      }

      .nav-text-main {
        font-size: 25px;
      }

      .nav-text-sub {
        font-size: 20px;
        color: #9ca3af;
      }

      .nav-item.active .nav-text-sub {
        color: #0f172a;
      }

      /* ========================= MAIN ========================= */

      .main-area {
        flex: 1;
        padding: 22px 26px 32px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .main-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding: 14px 18px;
        border-radius: 18px;
        background: rgba(15, 23, 42, 0.75);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.7);
      }

      .main-title {
        font-size: 40px;
        font-weight: 700;
      }

      .main-subtitle {
        font-size: 20px;
        color: #9ca3af;
        margin-top: 4px;
      }

      .user-box {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(15, 23, 42, 0.7);
        padding: 6px 10px;
        border-radius: 999px;
      }

      .user-name-pill {
        padding: 10px 15px;
        border-radius: 999px;
        background: rgba(55, 65, 81, 0.8);
        font-size: 15px;
      }

      .btn-logout {
        border: none;
        border-radius: 999px;
        padding: 15px 40px;
        font-size: 20px;
        font-weight: 600;
        cursor: pointer;
        background: #ef4444;
        color: #fee2e2;
        box-shadow: 0 6px 14px rgba(248, 113, 113, 0.4);
        transition: transform 0.1s ease, box-shadow 0.1s ease,
          background 0.1s ease;
      }

      .btn-logout:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 22px rgba(248, 113, 113, 0.6);
        background: #dc2626;
      }

      /* ================== CARD M√î PH·ªéNG GARDEN ================== */

      .garden-sim {
        margin-top: -20px;
        width: 100%;
        flex: 1;
        display: flex;
      }

.garden-sim-card {
  position: relative;
  width: 100%;
  max-width: 100%;
  min-height: calc(100vh - 170px);
  margin: 0;
  border-radius: 24px;
  padding: 28px 32px;
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;

  /* n·ªÅn c√¢y */
  background-position: center;
  background-size: cover;
  background-repeat: no-repeat;
  box-shadow: 0 20px 45px rgba(15, 23, 42, 0.7);
  overflow: hidden;

  /* gi√∫p ·∫£nh n√©t h∆°n khi scale (kh√¥ng b·∫Øt bu·ªôc nh∆∞ng n√™n c√≥) */
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
}

/* overlay ch·ªâ l√†m t·ªëi nh·∫π b√™n tr√°i, kh√¥ng ph·ªß k√≠n c√¢y */
.garden-sim-card::before {
  content: "";
  position: absolute;
  inset: 0;
  /* overlay nh·∫π, ch·ªâ n·∫±m quanh khu panel b√™n tr√°i */
  background: radial-gradient(
    circle at 140px 50%,
    rgba(15, 23, 42, 0.65) 0%,
    rgba(15, 23, 42, 0.35) 22%,
    rgba(15, 23, 42, 0.0) 50%
  );
  pointer-events: none;
}



      .garden-sim-left {
        position: relative;
        z-index: 1;
        max-width: 520px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .garden-sim-title {
        margin: 0;
        font-size: 22px;
        font-weight: 700;
      }

      .garden-sim-sub {
        margin: 0 0 8px;
        font-size: 13px;
        color: #e5e7eb;
      }

      /* ==== 3 KHUNG TR·∫ÆNG M√î PH·ªéNG ==== */

      .sim-summary-boxes {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
      }

      .sim-summary-box {
        background: rgba(255, 255, 255, 0.12); /* tr·∫Øng trong su·ªët */
        border: 1px solid rgba(148, 163, 184, 0.8); /* vi·ªÅn x√°m */
        border-radius: 18px;
        padding: 10px 14px;
        backdrop-filter: blur(6px);
      }

      .sim-summary-title {
        font-size: 13px;
        color: #d1d5db;
        margin-bottom: 4px;
      }

      .sim-summary-value {
        font-size: 20px;
        font-weight: 600;
      }

      /* Badge c≈© v·∫´n gi·ªØ n·∫øu sau n√†y b·∫°n d√πng l·∫°i */
      .stat-badge {
        display: inline-block;
        margin-top: 4px;
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 600;
        background: rgba(96, 165, 250, 0.15);
        border: 1px solid rgba(96, 165, 250, 0.5);
        color: #bfdbfe;
      }

      /* Nh√≥m n√∫t +100ml v√† Reset */
      .garden-sim-actions {
        display: flex;
        gap: 12px;
        margin-top: 12px;
      }

      /* N√∫t +100ml: xanh pastel trong su·ªët + vi·ªÅn xanh ƒë·∫≠m */
      .btn-sim-primary {
        border-radius: 999px;
        padding: 8px 20px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        border: 1px solid #1d4ed8; /* xanh ƒë·∫≠m */
        background: rgba(59, 130, 246, 0.18); /* xanh pastel trong su·ªët */
        color: #eff6ff;
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
      }

      /* N√∫t Reset: x√°m trong su·ªët + vi·ªÅn x√°m ƒë·∫≠m */
      .btn-sim-ghost {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.85);
        padding: 8px 18px;
        font-size: 13px;
        font-weight: 500;
        background: rgba(15, 23, 42, 0.3);
        color: #e5e7eb;
        cursor: pointer;
      }

      .garden-threshold-list {
        margin: 12px 0 0;
        padding-left: 20px;
        font-size: 12px;
        color: #e5e7eb;
      }

      .garden-threshold-list li + li {
        margin-top: 4px;
      }

      @media (max-width: 900px) {
        .garden-sim-card {
          flex-direction: column;
          min-height: 0;
        }
      }

      /* ================== ƒê·ªíNG H·ªí G√ìC PH·∫¢I D∆Ø·ªöI ================== */

      .realtime-clock {
        position: fixed;
        bottom: 10px;
        right: 20px;
        z-index: 50;
        padding: 20px 40px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.85);
        color: #e5e7eb;
        font-size: 25px;
        font-weight: 500;
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <!-- ========================= SIDEBAR ========================= -->
      <aside class="sidebar">
        <div class="sidebar-brand">
          <div class="sidebar-brand-icon">
            <img src="/static/doctorx_logo.png" alt="DoctorX Logo" />
          </div>
          <div>
            <div class="sidebar-brand-text-main">IoT Drinking Tracker</div>
            <div class="sidebar-brand-text-sub">Drink ¬∑ Grow ¬∑ Repeat</div>
          </div>
        </div>

        <div class="sidebar-nav">
          <div class="nav-label-heading">MENU</div>

          <button class="nav-item active" data-section="garden">
            <div class="nav-icon">üè°</div>
            <div>
              <div class="nav-text-main">Garden</div>
              <div class="nav-text-sub">T·ªïng quan c√¢y & n∆∞·ªõc</div>
            </div>
          </button>

          <button class="nav-item" data-section="achievements">
            <div class="nav-icon">üèÜ</div>
            <div>
              <div class="nav-text-main">Achievements</div>
              <div class="nav-text-sub">Th√†nh t√≠ch u·ªëng n∆∞·ªõc</div>
            </div>
          </button>

          <button class="nav-item" data-section="shop">
            <div class="nav-icon">üõí</div>
            <div>
              <div class="nav-text-main">Shop</div>
              <div class="nav-text-sub">Ch·∫≠u c√¢y & skin</div>
            </div>
          </button>

          <button class="nav-item" data-section="activities">
            <div class="nav-icon">üìã</div>
            <div>
              <div class="nav-text-main">Activities</div>
              <div class="nav-text-sub">Nh·∫≠t k√Ω u·ªëng n∆∞·ªõc</div>
            </div>
          </button>

          <button class="nav-item" data-section="personal">
            <div class="nav-icon">üë§</div>
            <div>
              <div class="nav-text-main">Personal</div>
              <div class="nav-text-sub">Th√¥ng tin & c√†i ƒë·∫∑t</div>
            </div>
          </button>
        </div>
      </aside>

      <!-- ========================= MAIN ========================= -->
      <main class="main-area">
        <header class="main-header">
          <div>
            <div class="main-title">Garden</div>
            <div class="main-subtitle">
              Theo d√µi l∆∞·ª£ng n∆∞·ªõc u·ªëng h·∫±ng ng√†y v√† s·ª©c kh·ªèe c·ªßa c√¢y.
            </div>
          </div>

          <div class="user-box">
            <span class="user-name-pill" id="user-pill">user</span>
            <button id="btn-logout" class="btn-logout">ƒêƒÉng xu·∫•t</button>
          </div>
        </header>

        <!-- ================== CARD M√î PH·ªéNG GARDEN ================== -->
        <section class="garden-sim">
          <div class="garden-sim-card" id="sim-bg">
            <div class="garden-sim-left">

              <!-- 3 khung tr·∫Øng -->
              <div class="sim-summary-boxes">
                <!-- Khung 1 -->
                <div class="sim-summary-box">
                  <div class="sim-summary-title">ƒê√£ m√¥ ph·ªèng</div>
                  <div class="sim-summary-value">
                    <span id="sim-water-ml">0</span> ml
                  </div>
                </div>

                <!-- Khung 2 -->
                <div class="sim-summary-box">
                  <div class="sim-summary-title">Tr·∫°ng th√°i c√¢y</div>
                  <div class="sim-summary-value" id="sim-status-text">
                    Kh√¥ h√©o
                  </div>
                </div>

                <!-- Khung 3 -->
                <div class="sim-summary-box">
                  <div class="sim-summary-title">S·ªë ng√†y ƒë√£ th·ª±c hi·ªán</div>
                  <div class="sim-summary-value">
                    <span id="sim-days">0</span> ng√†y
                  </div>
                </div>
              </div>

              <!-- N√∫t -->
              <div class="garden-sim-actions">
                <button id="btn-add-100" class="btn-sim-primary">
                  +100 ml
                </button>
                <button id="btn-reset-sim" class="btn-sim-ghost">Reset</button>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- ƒê·ªìng h·ªì th·ªùi gian th·ª±c -->
    <div class="realtime-clock" id="realtime-clock"></div>

    <script>
      /* ===== AUTH ===== */
      const token = localStorage.getItem("access_token");
      const userEmail = localStorage.getItem("user_email");

      if (!token) {
        window.location.href = "/app";
      }

      const userPillEl = document.getElementById("user-pill");
      if (userEmail && userPillEl) {
        const namePart = userEmail.split("@")[0];
        userPillEl.textContent = namePart || userEmail;
      }

      const logoutBtn = document.getElementById("btn-logout");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("access_token");
          localStorage.removeItem("user_email");
          window.location.href = "/app";
        });
      }

      /* ===== NAV (t·∫°m th·ªùi ch·ªâ log) ===== */
      document.querySelectorAll(".nav-item").forEach((btn) => {
        btn.addEventListener("click", () => {
          const section = btn.dataset.section;
          console.log("Nav clicked:", section);
        });
      });

      /* ===== M√î PH·ªéNG GARDEN +100 ML ===== */

      const simWaterEl = document.getElementById("sim-water-ml");
      const simStatusEl = document.getElementById("sim-status-text");
      const simDaysEl = document.getElementById("sim-days");
      const simBg = document.getElementById("sim-bg");
      const btnAdd100 = document.getElementById("btn-add-100");
      const btnResetSim = document.getElementById("btn-reset-sim");

      const DAILY_TARGET_ML = 2000;
      let simWaterMl = 0;
      let simDays = 0;

      // ----- ch·ªçn background theo gi·ªù cho t·ª´ng tr·∫°ng th√°i -----

      function getDryBgByTime() {
        const hour = new Date().getHours();
        if (hour >= 5 && hour < 11) {
          return "/static/plant_dry_morning.png";
        } else if (hour >= 11 && hour < 14) {
          return "/static/plant_dry_lunch.png";
        } else if (hour >= 14 && hour < 18) {
          return "/static/plant_dry_afternoon.png";
        } else {
          return "/static/plant_dry_night.png";
        }
      }

      function getGrowingBgByTime() {
        const hour = new Date().getHours();
        if (hour >= 5 && hour < 11) {
          return "/static/plant_growing_morning.png";
        } else if (hour >= 11 && hour < 14) {
          return "/static/plant_growing_lunch.png";
        } else if (hour >= 14 && hour < 18) {
          return "/static/plant_growing_afternoon.png";
        } else {
          return "/static/plant_growing_night.png";
        }
      }

      function getHealthyBgByTime() {
        const hour = new Date().getHours();
        if (hour >= 5 && hour < 11) {
          return "/static/plant_healthy_morning.png";
        } else if (hour >= 11 && hour < 14) {
          return "/static/plant_healthy_lunch.png";
        } else if (hour >= 14 && hour < 18) {
          return "/static/plant_healthy_afternoon.png";
        } else {
          return "/static/plant_healthy_night.png";
        }
      }

      function getBloomBgByTime() {
        const hour = new Date().getHours();
        if (hour >= 5 && hour < 11) {
          return "/static/plant_bloom_morning.png";
        } else if (hour >= 11 && hour < 14) {
          return "/static/plant_bloom_lunch.png";
        } else if (hour >= 14 && hour < 18) {
          return "/static/plant_bloom_afternoon.png";
        } else {
          return "/static/plant_bloom_night.png";
        }
      }

      // Quy ƒë·ªïi ml -> tr·∫°ng th√°i + background
      function getStageFromMl(ml) {
        if (ml < 500) {
          return {
            label: "Kh√¥ h√©o",
            bg: getDryBgByTime(),
            x: "0px",
            y: "-30px",
          };
        } else if (ml < 1200) {
          return {
            label: "Ph√°t tri·ªÉn",
            bg: getGrowingBgByTime(),
            x: "0px",
            y: "-30px",
          };
        } else if (ml < DAILY_TARGET_ML) {
          return {
            label: "S·ªëng t·ªët",
            bg: getHealthyBgByTime(),
            x: "0px",
            y: "-30px",
          };
        } else {
          return {
            label: "N·ªü hoa",
            bg: getBloomBgByTime(),
            x: "0px",
            y: "-30px",
          };
        }
      }

      function updatePlantUI() {
        if (simWaterEl) simWaterEl.textContent = simWaterMl;
        if (simDaysEl) simDaysEl.textContent = simDays;

        const stage = getStageFromMl(simWaterMl);
        if (simStatusEl) simStatusEl.textContent = stage.label;
        if (simBg) {
          simBg.style.backgroundImage = `url('${stage.bg}')`;
          simBg.style.backgroundPosition = `${stage.x} ${stage.y}`;
        }
      }

      if (btnAdd100) {
        btnAdd100.addEventListener("click", () => {
          simWaterMl += 100;
          updatePlantUI();
        });
      }

      // Reset:
      // - n·∫øu ƒëang c√≥ ml > 0: reset ml v·ªÅ 0 v√† tƒÉng s·ªë ng√†y
      // - n·∫øu ml ƒë√£ 0 m√† b·∫•m ti·∫øp: reset lu√¥n c·∫£ s·ªë ng√†y v·ªÅ 0
      if (btnResetSim) {
        btnResetSim.addEventListener("click", () => {
          if (simWaterMl > 0) {
            simWaterMl = 0;
            simDays += 1;
          } else {
            simWaterMl = 0;
            simDays = 0;
          }
          updatePlantUI();
        });
      }

      updatePlantUI();

      /* ===== ƒê·ªíNG H·ªí HH:MM G√ìC PH·∫¢I ===== */

      function updateClock() {
        const clockEl = document.getElementById("realtime-clock");
        if (!clockEl) return;
        const now = new Date();
        const time = now.toLocaleTimeString("vi-VN", {
          hour: "2-digit",
          minute: "2-digit",
          hour12: false,
        });
        clockEl.textContent = time;
      }

      updateClock();
      setInterval(updateClock, 1000);

      /* ===== ƒê·ªîI THEME N·ªÄN THEO GI·ªú (background ngo√†i) ===== */

      function getDashboardThemeByHour(hour) {
        if (hour >= 6 && hour < 11) {
          return "/static/Morning_v1.png";
        } else if (hour >= 11 && hour < 14) {
          return "/static/Lunch_V1.png";
        } else if (hour >= 14 && hour < 18) {
          return "/static/Afternoon_V1.png";
        } else {
          return "/static/Night_V1.png";
        }
      }

      function applyDashboardTheme() {
        const now = new Date();
        const hour = now.getHours();
        const bg = getDashboardThemeByHour(hour);
        document.body.style.backgroundImage = `url('${bg}')`;
      }

      applyDashboardTheme();
      setInterval(applyDashboardTheme, 15 * 60 * 1000);
    </script>
  </body>
</html>
